<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Test page for Events API</title>
  <script type='text/javascript' id='lux-shop-loader' src='//dev.api.shoppable.co:3000/assets/js/shop.js?token=jj7JfIf9oO177lqX7c5503611'></script>
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
  <link href="http://combinecouture.com/css/frame.css" rel="stylesheet" type="text/css">
  <link href="/css/test_cart.css" rel="stylesheet" type="text/css">
  <script type="text/javascript">
    function print_r (array, return_val) {
      // http://kevin.vanzonneveld.net
      // +   original by: Michael White (http://getsprink.com)
      // +   improved by: Ben Bryan
      // +      input by: Brett Zamir (http://brett-zamir.me)
      // +      improved by: Brett Zamir (http://brett-zamir.me)
      // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
      // -    depends on: echo
      // *     example 1: print_r(1, true);
      // *     returns 1: 1
      var output = '',
        pad_char = ' ',
        pad_val = 4,
        d = this.window.document,
        getFuncName = function (fn) {
          var name = (/\W*function\s+([\w\$]+)\s*\(/).exec(fn);
          if (!name) {
            return '(Anonymous)';
          }
          return name[1];
        },
        repeat_char = function (len, pad_char) {
          var str = '';
          for (var i = 0; i < len; i++) {
            str += pad_char;
          }
          return str;
        },
        formatArray = function (obj, cur_depth, pad_val, pad_char) {
          if (cur_depth > 0) {
            cur_depth++;
          }

          var base_pad = repeat_char(pad_val * cur_depth, pad_char);
          var thick_pad = repeat_char(pad_val * (cur_depth + 1), pad_char);
          var str = '';

          if (typeof obj === 'object' && obj !== null && obj.constructor && getFuncName(obj.constructor) !== 'PHPJS_Resource') {
            str += 'Array\n' + base_pad + '(\n';
            for (var key in obj) {
              if (Object.prototype.toString.call(obj[key]) === '[object Array]') {
                str += thick_pad + '[' + key + '] => ' + formatArray(obj[key], cur_depth + 1, pad_val, pad_char);
              }
              else {
                str += thick_pad + '[' + key + '] => ' + obj[key] + '\n';
              }
            }
            str += base_pad + ')\n';
          }
          else if (obj === null || obj === undefined) {
            str = '';
          }
          else { // for our "resource" class
            str = obj.toString();
          }

          return str;
        };

      output = formatArray(array, 0, pad_val, pad_char);

      if (return_val !== true) {
        if (d.body) {
          this.echo(output);
        }
        else {
          try {
            d = XULDocument; // We're in XUL, so appending as plain text won't work; trigger an error out of XUL
            this.echo('<pre xmlns="http://www.w3.org/1999/xhtml" style="white-space:pre;">' + output + '</pre>');
          } catch (e) {
            this.echo(output); // Outputting as plain text may work in some plain XML
          }
        }
        return true;
      }
      return output;
    }
  </script>
</head>
<body>
  <a href="#" class="lux-cart-frame" data-style="modal" data-checkout="http://combinecouture.com/dev-checkout.html">SHOPPING BAG</a> <span class="lux-cart-label">&nbsp;</span>
  <br /><br />

  <h2>Testing Events API with a Grid Frame</h2>
  <p>Page contains all the various Events API hooks for testing purposes.</p>

  <h4 id="code-title"></h4>
  <pre id="code-data"></pre>

  <div class='lux-product-frame' data-frame='grid' data-id='4' data-share='1'></div>

  <script type="text/javascript">
    function getRandomInt (min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    $(document).ready(function() {

      var $title = $("#code-title");
      var $data = $("#code-data");

      shopevent.set_hook('allFramesLoaded','cageify', function (cartId) {
        //$('.blank-cell').each(function () {
        //  var $img = $('<img>');
        //  var _height = getRandomInt(100, 442);
        //  var _width = getRandomInt(100, 230);
        //  $img.attr('src', 'http://placekitten.com/' + _width + '/' + _height);
        //  $(this).append($img);
        //});
        $title.text('allFramesLoaded event triggered!');
        $data.html(cartId);
      });

      shopevent.set_hook('triggerGridModal', 'test_event', function (cartId, partNumber, productName, shareURL) {
        $title.text('triggerGridModal event triggered!');
        $data.html(cartId + "\n" + partNumber + "\n" + productName + "\n" + shareURL);
      });

      shopevent.set_hook('addItemToCart', 'test_event', function (cartId, product, productArray) {
        $title.text('addItemToCart event triggered!');
        $data.html(cartId + "\n" + print_r(product, TRUE) + "\n" + print_r(productArray, TRUE));
      });

      shopevent.set_hook('removeItemFromCart', 'test_event', function (cartId, product, productArray) {
        $title.text('removeItemFromCart event triggered!');
        $data.html(cartId + "\n" + product + "\n" + productArray);
      });

      shopevent.set_hook('updateItemInCart', 'test_event', function (cartId, product, productArray) {
        $title.text('updateItemInCart event triggered!');
        $data.html(cartId + "\n" + product + "\n" + productArray);
      });

      shopevent.set_hook('emptyCart', 'test_event', function (cartId, productArray) {
        $title.text('emptyCart event triggered!');
        $data.html(cartId + "\n" + productArray);
      });

    });

  </script>
</body>
</html>